<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¥åº·é¤æ¨è–¦å•å·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!--
====================================================================
meal_recommendation_3.html â€” å€‹äººåŒ–å•å·
--------------------------------------------------------------------
*å°‡å€‹äººåŒ–å•å·ä¸²ä¸Šé£Ÿç‰©æ¨è–¦ç³»çµ±çš„è³‡æ–™åº«
*å°‡å€‹äººåŒ–å•å·ä¸²ä¸Šé£Ÿç‰©æ¨è–¦ç³»çµ±

meal_recommendation_3.html + index_18.html + server_11.js

ã€è³‡æ–™ä¾†æºã€‘
- é¤é»ç¢ç‰‡ï¼šfood_fragments.json
- æ¨è–¦é‚è¼¯ï¼šserver_11.js
- APIï¼šPOST /recommend
- ç¶²é ï¼šhttp://localhost:3000/index_18.html
====================================================================
-->
  <html lang="zh-Hant">
<head>

  <style>
    :root {
      --primary: #4caf93;
      --primary-light: #e3f5ef;
      --bg: #f7f8fb;
      --text-main: #222;
      --text-sub: #666;
      --card-bg: #ffffff;
      --border-radius: 16px;
      --transition-fast: 0.2s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", "PingFang TC", "Microsoft JhengHei", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 16px;
    }

    .card {
      background: var(--card-bg);
      max-width: 480px;
      width: 100%;
      margin: auto;
      border-radius: var(--border-radius);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.06);
      padding: 20px 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 600px) {
      .card {
        padding: 28px 28px 20px;
      }
    }

    .header {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .step-indicator {
      font-size: 13px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-top: 8px;
    }


    .progress-fill {
      height: 6px;
      width: 0%;
      background: linear-gradient(90deg, #86e3ce, #4caf93);
      border-radius: 999px;
      transition: width var(--transition-fast);
    }

    .question-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .question-subtitle {
      font-size: 14px;
      color: var(--text-sub);
    }

    .content {
      flex: 1;
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .options-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .option-chip {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      background: #ffffff;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .option-chip span.icon {
      font-size: 16px;
    }

    .option-chip.selected {
      background: var(--primary-light);
      border-color: var(--primary);
      color: var(--primary);
      box-shadow: 0 0 0 1px rgba(76, 175, 147, 0.25);
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-top: 4px;
    }

    .text-input,
    .select-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 14px;
      font-size: 14px;
      outline: none;
      transition: border-color var(--transition-fast),
        box-shadow var(--transition-fast);
    }

    .text-input:focus,
    .select-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(76, 175, 147, 0.25);
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }

    .btn {
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: background var(--transition-fast), opacity var(--transition-fast),
        transform var(--transition-fast), box-shadow var(--transition-fast);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }
    .btn-primary {
      background: var(--primary);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(76, 175, 147, 0.35);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(76, 175, 147, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-sub);
    }

    .hint {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .summary-block {
      background: #f3f4f6;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      color: #374151;
      line-height: 1.5;
    }
    .summary-block strong {
      display: inline-block;
      margin-right: 4px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5f3ef;
      font-size: 12px;
      margin: 2px 4px 2px 0;
      color: #047857;
    }

    .fade {
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <div class="header">
        <div class="app-title">Healthy Daily</div>
        <div class="step-indicator" id="stepIndicator"></div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <!-- å•å·å…§å®¹å€ -->
      <div class="content" id="content"></div>

      <!-- åº•éƒ¨æŒ‰éˆ• -->
      <div class="footer">
        <button class="btn btn-secondary" id="prevBtn">ä¸Šä¸€é </button>
        <button class="btn btn-primary" id="nextBtn">
          ä¸‹ä¸€æ­¥
        </button>
      </div>
    </div>
  </div>
  <script>
    // å„²å­˜ä½¿ç”¨è€…å¡«å¯«çµæœçš„ç‰©ä»¶
    const profile = {
      dietRestrictions: [],
      dietOthers: "",
      cuisines: [],
      dislikes: [],
      dislikesOthers: "",
      maxCookTime: null,
      level: null,
      healthGoals: [],
      people: null,
      appPurposes: [],
    };

    // å•å·æ­¥é©Ÿç¸½æ•¸ï¼ˆä¸å«æ­¡è¿é ç®—æ­¥é©Ÿçš„è©±å¯ä»¥å¾®èª¿ï¼‰
    const steps = [
      { id: "welcome" },
      { id: "diet" },
      { id: "like_dislike" },
      { id: "cook_habit" },
      { id: "health_goal" },
      { id: "people_usage" },
      { id: "summary" },
    ];

    let currentStepIndex = 0;

    const contentEl = document.getElementById("content");
    const stepIndicatorEl = document.getElementById("stepIndicator");
    const progressFillEl = document.getElementById("progressFill");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    // å·¥å…·ï¼šå»ºç«‹å¤šé¸ chip
    function createOptionChip(label, value, icon, multi, groupKey) {
      const chip = document.createElement("button");
      chip.type = "button";
      chip.className = "option-chip";
      chip.dataset.value = value;
      chip.dataset.multi = multi ? "1" : "0";
      chip.dataset.group = groupKey;

      if (icon) {
        const ic = document.createElement("span");
        ic.className = "icon";
        ic.textContent = icon;
        chip.appendChild(ic);
      }

      const textNode = document.createElement("span");
      textNode.textContent = label;
      chip.appendChild(textNode);

      chip.addEventListener("click", () => {
        const isMulti = chip.dataset.multi === "1";

        if (!isMulti) {
          // å–®é¸ï¼šåŒ group å…¶ä»–éƒ½å–æ¶ˆ
          const group = chip.dataset.group;
          document
            .querySelectorAll(`.option-chip[data-group="${group}"]`)
            .forEach((c) => c.classList.remove("selected"));
          chip.classList.add("selected");
        } else {
          chip.classList.toggle("selected");
        }

        syncCurrentStepToProfile();
        updateNextButtonState();
      });

      return chip;
    }

    // UIï¼šé¡¯ç¤ºç›®å‰æ­¥é©Ÿ
    function renderStep() {
      contentEl.classList.remove("fade");
      void contentEl.offsetWidth; // reset animation
      contentEl.classList.add("fade");

      const step = steps[currentStepIndex];

      // æ›´æ–°æ­¥é©Ÿæ–‡å­— & é€²åº¦æ¢ï¼ˆæ­¡è¿é ä¸ç®—åœ¨ 1/6 è£¡ï¼‰
      const totalRealSteps = steps.length - 2; // é™¤å» welcome & summary
      let displayIndex = currentStepIndex;
      if (step.id === "welcome") {
        stepIndicatorEl.textContent = "æ­¡è¿ä½¿ç”¨ Â· å®¢è£½åŒ–ä½ çš„å¥åº·é¤";
        progressFillEl.style.width = "0%";
      } else if (step.id === "summary") {
        stepIndicatorEl.textContent = "å®Œæˆè¨­å®š";
        progressFillEl.style.width = "100%";
      } else {
        displayIndex = currentStepIndex; // diet=1,...people_usage=5
        const num = displayIndex;
        stepIndicatorEl.textContent = `å•é¡Œ ${num} / ${totalRealSteps}`;
        const percent = (num / totalRealSteps) * 100;
        progressFillEl.style.width = `${percent}%`;
      }

      // åˆ‡æ›ä¸Šä¸‹é æŒ‰éˆ•é¡¯ç¤º
      if (step.id === "welcome") {
        prevBtn.style.visibility = "hidden";
        nextBtn.textContent = "é–‹å§‹";
      } else if (step.id === "summary") {
        prevBtn.style.visibility = "visible";
        nextBtn.textContent = "å®Œæˆ";
      } else {
        prevBtn.style.visibility = currentStepIndex === 0 ? "hidden" : "visible";
        nextBtn.textContent = "ä¸‹ä¸€æ­¥";
      }

      // æ ¹æ“šæ­¥é©Ÿæ¸²æŸ“å…§å®¹
      switch (step.id) {
        case "welcome":
          renderWelcome();
          break;
        case "diet":
          renderDiet();
          break;
        case "like_dislike":
          renderLikeDislike();
          break;
        case "cook_habit":
          renderCookHabit();
          break;
        case "health_goal":
          renderHealthGoal();
          break;
        case "people_usage":
          renderPeopleUsage();
          break;
        case "summary":
          renderSummary();
          break;
      }

      updateNextButtonState();
    }
    // æ­¥é©Ÿå…§å®¹ï¼šæ­¡è¿é 
    function renderWelcome() {
      contentEl.innerHTML = `
        <div>
          <div class="question-title">è®“æˆ‘äº†è§£ä½ çš„é£²é£Ÿé¢¨æ ¼ âœ¨</div>
          <div class="question-subtitle">
            æˆ‘æœƒå•å¹¾å€‹ç°¡å–®çš„å•é¡Œï¼Œç‚ºä½ æ­é…æ¯å¤©ä¸ä¸€æ¨£ã€åˆå¥åº·çš„æ¯ä¸€é¤ã€‚
          </div>
        </div>
      `;
    }

    // æ­¥é©Ÿå…§å®¹ï¼šé£²é£Ÿé™åˆ¶
    function renderDiet() {
      contentEl.innerHTML = "";

      const header = document.createElement("div");
      header.innerHTML = `
        <div class="question-title">ä½ æœ‰ä»€éº¼é£²é£Ÿé™åˆ¶å—ï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå¯å¤šé¸ï¼‰</div>
      `;
      contentEl.appendChild(header);

      const grid = document.createElement("div");
      grid.className = "options-grid";

      const items = [
        { label: "ä¸åƒç‰›", value: "no_beef", icon: "ğŸ„" },
        { label: "ä¸åƒè±¬", value: "no_pork", icon: "ğŸ–" },
        { label: "ä¸åƒç¾Š", value: "no_lamb", icon: "ğŸ‘" },
        { label: "ä¸åƒæµ·é®®", value: "no_seafood", icon: "ğŸ¤" },
        { label: "è›‹å¥¶ç´ ", value: "lacto_ovo", icon: "ğŸ³" },
        { label: "å…¨ç´ ", value: "vegan", icon: "ğŸ¥¦" },
      ];

      items.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          it.icon,
          true,
          "dietRestrictions"
        );
        if (profile.dietRestrictions.includes(it.value)) {
          chip.classList.add("selected");
        }
        grid.appendChild(chip);
      });

      contentEl.appendChild(grid);

      const otherWrapper = document.createElement("div");
      otherWrapper.style.marginTop = "10px";
      otherWrapper.innerHTML = `
        <div class="section-title">å…¶å®ƒç‰¹åˆ¥ä¸åƒçš„ï¼Ÿï¼ˆé¸å¡«ï¼‰</div>
        <input class="text-input" id="dietOthersInput"
          placeholder="ä¾‹å¦‚ï¼šå…§è‡Ÿã€ç‰›å¥¶ã€èµ·å¸â€¦" />
        <div class="hint">é€™æœƒå¹«åŠ©æˆ‘æ›´ç²¾æº–åœ°é¿é–‹ä½ ä¸å–œæ­¡çš„é£Ÿæã€‚</div>
      `;
      contentEl.appendChild(otherWrapper);

      const dietOthersInput = otherWrapper.querySelector("#dietOthersInput");
      dietOthersInput.value = profile.dietOthers || "";
      dietOthersInput.addEventListener("input", () => {
        profile.dietOthers = dietOthersInput.value.trim();
      });
    }

    // æ­¥é©Ÿå…§å®¹ï¼šå–œæ­¡ï¼ä¸å–œæ­¡
    function renderLikeDislike() {
      contentEl.innerHTML = "";

      const section1 = document.createElement("div");
      section1.innerHTML = `
        <div class="section-title">ä½ å–œæ­¡ä»€éº¼é¢¨æ ¼çš„æ–™ç†ï¼Ÿï¼ˆå¯å¤šé¸ï¼‰</div>
      `;
      contentEl.appendChild(section1);

      const grid1 = document.createElement("div");
      grid1.className = "options-grid";
      const cuisineItems = [
        { label: "å°å¼", value: "taiwanese" },
        { label: "æ—¥å¼", value: "japanese" },
        { label: "éŸ“å¼", value: "korean" },
        { label: "ç¾©å¼", value: "italian" },
        { label: "ç°¡å–®è¥¿å¼", value: "western" },
        { label: "æ¸…çˆ½è¼•é£Ÿ", value: "light_meal" },
        { label: "æ¹¯ï¼é‹ç‰©", value: "soup_hotpot" },
      ];
      cuisineItems.forEach((it) => {
        const chip = createOptionChip(it.label, it.value, "", true, "cuisines");
        if (profile.cuisines.includes(it.value)) {
          chip.classList.add("selected");
        }
        grid1.appendChild(chip);
      });
      contentEl.appendChild(grid1);

      const section2 = document.createElement("div");
      section2.style.marginTop = "16px";
      section2.innerHTML = `
        <div class="section-title">æœ‰ä»€éº¼ç‰¹åˆ¥ä¸å–œæ­¡çš„å‘³é“ï¼Ÿï¼ˆå¯å¤šé¸ï¼‰</div>
      `;
      contentEl.appendChild(section2);

      const grid2 = document.createElement("div");
      grid2.className = "options-grid";
      const dislikeItems = [
        { label: "é¦™èœ", value: "cilantro" },
        { label: "æ´‹è”¥", value: "onion" },
        { label: "é’æ¤’", value: "green_pepper" },
        { label: "è–‘", value: "ginger" },
        { label: "è’œé ­", value: "garlic" },
        { label: "èŒ„å­", value: "eggplant" },
      ];
      dislikeItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          "",
          true,
          "dislikes"
        );
        if (profile.dislikes.includes(it.value)) {
          chip.classList.add("selected");
        }
        grid2.appendChild(chip);
      });
      contentEl.appendChild(grid2);

      const otherWrapper = document.createElement("div");
      otherWrapper.style.marginTop = "10px";
      otherWrapper.innerHTML = `
        <div class="section-title">å…¶å®ƒä¸å–œæ­¡çš„å‘³é“ï¼Ÿï¼ˆé¸å¡«ï¼‰</div>
        <input class="text-input" id="dislikesOthersInput"
          placeholder="ä¾‹å¦‚ï¼šå¤ªè¾£ã€å¤ªç”œã€æŸç¨®é¦™æ–™â€¦" />
      `;
      contentEl.appendChild(otherWrapper);

      const dislikesOthersInput = otherWrapper.querySelector(
        "#dislikesOthersInput"
      );
      dislikesOthersInput.value = profile.dislikesOthers || "";
      dislikesOthersInput.addEventListener("input", () => {
        profile.dislikesOthers = dislikesOthersInput.value.trim();
      });
    }

    // æ­¥é©Ÿå…§å®¹ï¼šçƒ¹é£ªç¿’æ…£
    function renderCookHabit() {
      contentEl.innerHTML = "";

      const q1 = document.createElement("div");
      q1.innerHTML = `
        <div class="question-title">ä½ å¹³å¸¸é¡˜æ„èŠ±å¤šå°‘æ™‚é–“ç…®é£¯ï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå–®é¸ï¼‰</div>
      `;
      contentEl.appendChild(q1);

      const grid1 = document.createElement("div");
      grid1.className = "options-grid";

      const timeItems = [
        { label: "10 åˆ†é˜ä»¥å…§", value: "10" },
        { label: "20 åˆ†é˜å·¦å³", value: "20" },
        { label: "30 åˆ†é˜å¯ä»¥æ¥å—", value: "30" },
        { label: "æ¯”è¼ƒæœ‰ç©ºï¼Œåšè¤‡é›œçš„ä¹Ÿå¯ä»¥", value: "60" },
      ];

      timeItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          "",
          false,
          "maxCookTime"
        );
        if (String(profile.maxCookTime) === String(it.value)) {
          chip.classList.add("selected");
        }
        grid1.appendChild(chip);
      });
      contentEl.appendChild(grid1);

      const q2 = document.createElement("div");
      q2.style.marginTop = "18px";
      q2.innerHTML = `
        <div class="question-title">ä½ è¦ºå¾—è‡ªå·±çš„æ–™ç†ç¨‹åº¦ï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå–®é¸ï¼‰</div>
      `;
      contentEl.appendChild(q2);

      const grid2 = document.createElement("div");
      grid2.className = "options-grid";

      const levelItems = [
        { label: "æ–°æ‰‹ï¼ˆåªæœƒç‚’è›‹ã€ç…®éºµï¼‰", value: "beginner" },
        { label: "å…¥é–€ï¼ˆæœƒç‚’é’èœã€ç…è‚‰ï¼‰", value: "basic" },
        { label: "ç†Ÿç·´ï¼ˆçœ‹é£Ÿè­œéƒ½èƒ½åšï¼‰", value: "intermediate" },
        { label: "é«˜æ‰‹ï¼ˆå¯ä»¥æŒ‘æˆ°æ¯”è¼ƒç´°çš„æ–™ç†ï¼‰", value: "advanced" },
      ];

      levelItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          "",
          false,
          "level"
        );
        if (profile.level === it.value) {
          chip.classList.add("selected");
        }
        grid2.appendChild(chip);
      });
      contentEl.appendChild(grid2);
    }

    // æ­¥é©Ÿå…§å®¹ï¼šå¥åº·ç›®æ¨™
    function renderHealthGoal() {
      contentEl.innerHTML = "";

      const header = document.createElement("div");
      header.innerHTML = `
        <div class="question-title">ç¾åœ¨çš„ä½ ï¼Œæœ€å¸Œæœ›åƒå¾—æ€éº¼æ¨£ï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå¯å¤šé¸ï¼‰</div>
      `;
      contentEl.appendChild(header);

      const grid = document.createElement("div");
      grid.className = "options-grid";

      const goalItems = [
        { label: "æ¸…çˆ½ä¸€é»", value: "light", icon: "ğŸŒ¿" },
        { label: "å¤šåƒè›‹ç™½è³ª", value: "more_protein", icon: "ğŸ¥š" },
        { label: "å¤šåƒè”¬èœ", value: "more_veggies", icon: "ğŸ¥—" },
        { label: "å°‘æ¾±ç²‰", value: "less_carbs", icon: "ğŸš" },
        { label: "ç¶­æŒé«”é‡", value: "maintain_weight", icon: "â¤ï¸" },
        { label: "æƒ³å¢è‚Œ", value: "muscle_gain", icon: "ğŸ‹ï¸â€â™€ï¸" },
        { label: "æƒ³æ¸›è„‚", value: "fat_loss", icon: "ğŸ”¥" },
      ];

      goalItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          it.icon,
          true,
          "healthGoals"
        );
        if (profile.healthGoals.includes(it.value)) {
          chip.classList.add("selected");
        }
        grid.appendChild(chip);
      });
      contentEl.appendChild(grid);
    }

    // æ­¥é©Ÿå…§å®¹ï¼šäººæ•¸ & ä½¿ç”¨ç›®çš„
    function renderPeopleUsage() {
      contentEl.innerHTML = "";

      const q1 = document.createElement("div");
      q1.innerHTML = `
        <div class="question-title">é€šå¸¸å¹¾å€‹äººä¸€èµ·åƒï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå–®é¸ï¼‰</div>
      `;
      contentEl.appendChild(q1);
      const grid1 = document.createElement("div");
      grid1.className = "options-grid";

      const peopleItems = [
        { label: "ä¸€å€‹äºº", value: "1" },
        { label: "å…©å€‹äºº", value: "2" },
        { label: "ä¸‰ï½å››äºº", value: "3-4" },
        { label: "æ›´å¤šï¼ˆå®¶äººä¸€èµ·ï¼‰", value: "5+" },
      ];

      peopleItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          "",
          false,
          "people"
        );
        if (profile.people === it.value) {
          chip.classList.add("selected");
        }
        grid1.appendChild(chip);
      });
      contentEl.appendChild(grid1);

      const q2 = document.createElement("div");
      q2.style.marginTop = "18px";
      q2.innerHTML = `
        <div class="question-title">ä½ å¸Œæœ›é€™å€‹æœå‹™ä¸»è¦å¹«ä½ ä»€éº¼ï¼Ÿ</div>
        <div class="question-subtitle">ï¼ˆå¯å¤šé¸ï¼‰</div>
      `;
      contentEl.appendChild(q2);
      const grid2 = document.createElement("div");
      grid2.className = "options-grid";

      const purposeItems = [
        { label: "æ¯å¤©æ¨è–¦ä¸ä¸€æ¨£çš„æ™šé¤", value: "different_dinner" },
        { label: "å¥åº·é£²é£Ÿè¦åŠƒ", value: "healthy_plan" },
        { label: "ç”¨å†°ç®±çš„é£Ÿææ‰¾æ–™ç†", value: "by_fridge" },
        { label: "æ”¶è—æˆ‘çš„èœå–®", value: "favorites" },
        { label: "ç´€éŒ„æ¯å¤©åƒä»€éº¼", value: "meal_log" },
      ];

      purposeItems.forEach((it) => {
        const chip = createOptionChip(
          it.label,
          it.value,
          "",
          true,
          "appPurposes"
        );
        if (profile.appPurposes.includes(it.value)) {
          chip.classList.add("selected");
        }
        grid2.appendChild(chip);
      });
      contentEl.appendChild(grid2);
    }
    // æ­¥é©Ÿå…§å®¹ï¼šç¸½çµ
    function renderSummary() {
      contentEl.innerHTML = "";

      const header = document.createElement("div");
      header.innerHTML = `
        <div class="question-title">å·²ç¶“å¤§æ¦‚äº†è§£ä½ çš„é£²é£Ÿé¢¨æ ¼ ğŸ’›</div>
        <div class="question-subtitle">
          æ¥ä¸‹ä¾†ï¼Œæˆ‘æœƒæ ¹æ“šé€™äº›è¨­å®šï¼Œç‚ºä½ æ­é…æ¯å¤©ä¸ä¸€æ¨£ã€åˆå¥åº·çš„é¤é»ã€‚
        </div>
      `;
      contentEl.appendChild(header);

      const summary = document.createElement("div");
      summary.className = "summary-block";

      const cuisines = profile.cuisines.map(mapCuisineLabel).join("ã€") || "é¢¨æ ¼å¤šå…ƒ";
      const goals =
        profile.healthGoals.map(mapHealthGoalLabel).join("ã€") || "ä»¥å¥½åƒç‚ºä¸»";
      const people = mapPeopleLabel(profile.people);
      const level = mapLevelLabel(profile.level);

      summary.innerHTML = `
        <div><strong>é£²é£Ÿé¢¨æ ¼ï¼š</strong>${cuisines}</div>
        <div><strong>å¥åº·ç›®æ¨™ï¼š</strong>${goals}</div>
        <div><strong>é€šå¸¸ç”¨é¤äººæ•¸ï¼š</strong>${people}</div>
        <div><strong>æ–™ç†ç¨‹åº¦ï¼š</strong>${level}</div>
      `;
      contentEl.appendChild(summary);

      const hint = document.createElement("div");
      hint.className = "hint";
      hint.textContent = "å®Œæˆä¹‹å¾Œï¼Œä½ å°±å¯ä»¥é–‹å§‹æŠ½å–ã€Œä»Šå¤©è¦åƒä»€éº¼ã€å›‰ã€‚";
      contentEl.appendChild(hint);
    }
    // å°‡ç›®å‰ç•«é¢é¸é …å›å¯«åˆ° profile
    function syncCurrentStepToProfile() {
      const step = steps[currentStepIndex];

      if (step.id === "diet") {
        const selectedDiet = Array.from(
          document.querySelectorAll(
            '.option-chip[data-group="dietRestrictions"].selected'
          )
        ).map((c) => c.dataset.value);
        profile.dietRestrictions = selectedDiet;
      }

      if (step.id === "like_dislike") {
        const selectedCuisines = Array.from(
          document.querySelectorAll('.option-chip[data-group="cuisines"].selected')
        ).map((c) => c.dataset.value);
        profile.cuisines = selectedCuisines;

        const selectedDislikes = Array.from(
          document.querySelectorAll('.option-chip[data-group="dislikes"].selected')
        ).map((c) => c.dataset.value);
        profile.dislikes = selectedDislikes;
      }
      if (step.id === "cook_habit") {
        const maxCookTime = document.querySelector(
          '.option-chip[data-group="maxCookTime"].selected'
        );
        profile.maxCookTime = maxCookTime ? maxCookTime.dataset.value : null;

        const level = document.querySelector(
          '.option-chip[data-group="level"].selected'
        );
        profile.level = level ? level.dataset.value : null;
      }
      if (step.id === "health_goal") {
        const selectedGoals = Array.from(
          document.querySelectorAll(
            '.option-chip[data-group="healthGoals"].selected'
          )
        ).map((c) => c.dataset.value);
        profile.healthGoals = selectedGoals;
      }

      if (step.id === "people_usage") {
        const people = document.querySelector(
          '.option-chip[data-group="people"].selected'
        );
        profile.people = people ? people.dataset.value : null;

        const purposes = Array.from(
          document.querySelectorAll(
            '.option-chip[data-group="appPurposes"].selected'
          )
        ).map((c) => c.dataset.value);
        profile.appPurposes = purposes;
      }
    }
    // åˆ¤æ–·é€™ä¸€æ­¥æ˜¯å¦å¿…å¡«ã€æ˜¯å¦å¯ä¸‹ä¸€æ­¥
    function isStepValid() {
      const step = steps[currentStepIndex];

      if (step.id === "diet") {
        // é£²é£Ÿé™åˆ¶å¯ä»¥ä¸é¸ï¼Œæ°¸é æœ‰æ•ˆ
        return true;
      }

      if (step.id === "like_dislike") {
        // å–œæ­¡çš„æ–™ç†é¢¨æ ¼ï¼Œå»ºè­°è‡³å°‘é¸ä¸€å€‹
        return profile.cuisines.length > 0;
      }

      if (step.id === "cook_habit") {
        return profile.maxCookTime && profile.level;
      }

      if (step.id === "health_goal") {
        // è‡³å°‘ä¸€å€‹å¥åº·ç›®æ¨™
        return profile.healthGoals.length > 0;
      }

      if (step.id === "people_usage") {
        return !!profile.people;
      }

      // welcome & summary
      return true;
    }
    function updateNextButtonState() {
      const step = steps[currentStepIndex];

      if (step.id === "welcome" || step.id === "summary") {
        nextBtn.disabled = false;
        return;
      }

      nextBtn.disabled = !isStepValid();
    }

    // label mapping functions
    function mapCuisineLabel(v) {
      switch (v) {
        case "taiwanese":
          return "å°å¼";
        case "japanese":
          return "æ—¥å¼";
        case "korean":
          return "éŸ“å¼";
        case "italian":
          return "ç¾©å¼";
        case "western":
          return "ç°¡å–®è¥¿å¼";
        case "light_meal":
          return "æ¸…çˆ½è¼•é£Ÿ";
        case "soup_hotpot":
          return "æ¹¯ï¼é‹ç‰©";
        default:
          return v;
      }
    }
    function mapHealthGoalLabel(v) {
      switch (v) {
        case "light":
          return "æ¸…çˆ½ä¸€é»";
        case "more_protein":
          return "å¤šåƒè›‹ç™½è³ª";
        case "more_veggies":
          return "å¤šåƒè”¬èœ";
        case "less_carbs":
          return "å°‘æ¾±ç²‰";
        case "maintain_weight":
          return "ç¶­æŒé«”é‡";
        case "muscle_gain":
          return "æƒ³å¢è‚Œ";
        case "fat_loss":
          return "æƒ³æ¸›è„‚";
        default:
          return v;
      }
    }
    function mapPeopleLabel(v) {
      switch (v) {
        case "1":
          return "ä¸€å€‹äºº";
        case "2":
          return "å…©å€‹äºº";
        case "3-4":
          return "ä¸‰ï½å››äºº";
        case "5+":
          return "å®¶äººä¸€èµ·";
        default:
          return "å°šæœªè¨­å®š";
      }
    }

    function mapLevelLabel(v) {
      switch (v) {
        case "beginner":
          return "æ–°æ‰‹";
        case "basic":
          return "å…¥é–€";
        case "intermediate":
          return "ç†Ÿç·´";
        case "advanced":
          return "é«˜æ‰‹";
        default:
          return "å°šæœªè¨­å®š";
      }
    }
    // äº‹ä»¶ç¶å®šï¼šä¸Šä¸€é  / ä¸‹ä¸€æ­¥
    prevBtn.addEventListener("click", () => {
      if (currentStepIndex > 0) {
        currentStepIndex--;
        renderStep();
      }
    });
    nextBtn.addEventListener("click", () => {
      const step = steps[currentStepIndex];

      if (step.id !== "welcome" && step.id !== "summary") {
        syncCurrentStepToProfile();
      }

      if (step.id === "summary") {
        // âœ… ä»ç„¶å¯ä»¥å…ˆå­˜ localStorageï¼ˆä¿ç•™ï¼Œä¹‹å¾Œå¯æ‹¿æ‰ï¼‰
        localStorage.setItem("mealProfile", JSON.stringify(profile));

        console.log("ğŸ“¤ å•å·é€å‡ºä¸­ï¼š", profile);

        // âœ… é€åˆ°å¾Œç«¯å­˜ MySQL
        fetch("/submit-survey", {
          method: "POST",
          headers: {
          "Content-Type": "application/json"
          },
          body: JSON.stringify(profile)
        })
          .then(res => res.json())
          .then(result => {
          if (result.success) {
              console.log("âœ… å•å·å·²å­˜å…¥ MySQL");

              // âœ… æˆåŠŸå¾Œå†è·³è½‰æ¨è–¦é 
              window.location.href = "/index_18.html";
            } else {
             alert("å•å·å„²å­˜å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡");
            }
          })
          .catch(err => {
            console.error("âŒ å•å·é€å‡ºéŒ¯èª¤ï¼š", err);
            alert("é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
          });

        return;
      }

      if (!isStepValid()) return;

      if (currentStepIndex < steps.length - 1) {
        currentStepIndex++;
        renderStep();
      }
    });

    // åˆå§‹åŒ–
    renderStep();
  </script>
</body>
</html>









 